üîπ –ö–∞–∫ –ø–∏—Å–∞—Ç—å –±–µ–∑ $$?

–ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å $$, —Ç–æ –ø—Ä–∏–¥–µ—Ç—Å—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –æ–¥–∏–Ω–∞—Ä–Ω—É—é –∫–∞–≤—ã—á–∫—É –≤–Ω—É—Ç—Ä–∏ —Ç–µ–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏.

‚ùå –ü—Ä–∏–º–µ—Ä –±–µ–∑ $$ (–Ω–µ—É–¥–æ–±–Ω–æ):

CREATE FUNCTION example_function()
RETURNS TEXT AS '
BEGIN
    RETURN ''Hello, world!'';  -- –ù—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–≤—ã—á–∫–∏
END;
' LANGUAGE plpgsql;

CREATE FUNCTION example_function()
RETURNS TEXT AS $$
BEGIN
    RETURN 'Hello, world!';
END;
$$ LANGUAGE plpgsql;


CREATE FUNCTION example_function()
RETURNS TEXT AS $$mylabel$$
BEGIN
    RETURN 'Hello, world!';
END;
$$mylabel$$ LANGUAGE plpgsql;





üîπ –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –Ω–µ –Ω–∞–ø–∏—Å–∞—Ç—å FOR EACH ROW –≤ —Ç—Ä–∏–≥–≥–µ—Ä–µ?

–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å FOR EACH ROW –∏–ª–∏ FOR EACH STATEMENT, PostgreSQL –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
CREATE TRIGGER price_update_trigger
AFTER UPDATE OF price
ON menu_items
FOR EACH ROW --FOR EACH STATEMENT
EXECUTE FUNCTION record_price_change();

üîπ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å               FOR EACH ROW,               –∞ –∫–æ–≥–¥–∞ FOR EACH STATEMENT?
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ	                    FOR EACH ROW	            FOR EACH STATEMENT
–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏	        ‚úÖ –î–∞	            ‚ùå –ù–µ—Ç
–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ	            ‚úÖ –î–∞	            ‚úÖ –î–∞
–í—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥—É—é —Ç–∞–±–ª–∏—Ü—É	        ‚úÖ –î–∞	            ‚ùå –ù–µ—Ç
–†–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö	‚ùå –ù–µ—Ç      	        ‚úÖ –î–∞











–û–ø–µ—Ä–∞—Ç–æ—Ä	–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å NULL	–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
<>	–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç NULL	‚ùå –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
IS DISTINCT FROM	–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç TRUE/FALSE	‚úÖ –≤—Å–µ–≥–¥–∞

CREATE OR REPLACE FUNCTION log_order_status_change()
RETURNS TRIGGER AS $$
BEGIN
  -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å
  IF NEW.status IS DISTINCT FROM OLD.status THEN
    INSERT INTO order_status_history (order_id, status, updated_at)
    VALUES (NEW.id, NEW.status, CURRENT_TIMESTAMP);
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 2. –°–∞–º —Ç—Ä–∏–≥–≥–µ—Ä
CREATE TRIGGER trg_log_order_status_change
AFTER UPDATE ON orders
FOR EACH ROW
EXECUTE FUNCTION log_order_status_change();